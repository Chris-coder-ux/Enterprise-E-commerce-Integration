# Plan de Commits - Optimizaciones y Mejoras Fase 2

## Commit 1: Optimizaciones de rendimiento en Fase 2 (Backend)
**Tipo:** `perf`
**Descripción:** Optimizaciones críticas de rendimiento en sincronización de productos

```bash
git add includes/Helpers/MapProduct.php includes/Core/BatchProcessor.php includes/Core/Sync_Manager.php
git commit -m "perf(fase2): optimizaciones críticas de rendimiento

- Optimización consulta SQL get_attachments_by_article_id (1 query vs 3+N)
- Logging detallado solo en modo WP_DEBUG
- Fallback por hash deshabilitado en producción
- Limpieza de caché cada 5 lotes (configurable)
- Delay entre lotes reducido de 5s a 3s
- Verificación de attachments optimizada

Impacto esperado: reducción ~80-90% consultas SQL, ~70-85% tiempo total"
```

## Commit 2: Correcciones de errores y manejo de excepciones
**Tipo:** `fix`
**Descripción:** Corrección de errores críticos y mejor manejo de excepciones

```bash
git add includes/Helpers/MapProduct.php includes/Core/BatchProcessor.php includes/Admin/AjaxSync.php
git commit -m "fix(fase2): correcciones errores y manejo excepciones

- Eliminación método isDebugEnabled() inexistente
- Try-catch en mapeo productos para evitar rollback completo
- Endpoint acepta múltiples nonces (mia_queue_nonce, mi_integracion_api_nonce_dashboard)
- Productos procesados exitosamente se guardan aunque otros fallen

Resuelve: error 'Call to undefined method isDebugEnabled()'
Resuelve: problema solo 1 producto sincronizado"
```

## Commit 3: Mejoras frontend Fase 2 (throttling, reset, cancelación)
**Tipo:** `feat`
**Descripción:** Mejoras en frontend para prevenir múltiples inicializaciones y mejorar cancelación

```bash
git add assets/js/dashboard/sync/Phase2Manager.js assets/js/dashboard/components/SyncDashboard.js assets/js/dashboard/sync/SyncProgress.js
git commit -m "feat(fase2): mejoras frontend throttling y cancelación

- Throttling de logs de advertencia (máx 1 cada 5 segundos)
- Reset mejorado que detiene polling y limpia intervalos
- Cancelación mejorada que resetea flags y detiene polling
- Detección de cancelación desde backend en SyncProgress
- Protecciones contra múltiples inicializaciones

Resuelve: logs repetitivos tras cancelación
Resuelve: saturación de red por múltiples llamadas AJAX
Resuelve: página lenta al refrescar tras cancelar"
```

## Commit 4: Tests Jasmine para Fase 2
**Tipo:** `test`
**Descripción:** Tests unitarios con Jasmine para frontend Fase 2

```bash
git add spec/dashboard/sync/Phase2ManagerSpec.js spec/dashboard/components/SyncDashboardPhase2Spec.js spec/SpecRunner.html
git commit -m "test(fase2): tests Jasmine para frontend Fase 2

- Tests para Phase2Manager (protecciones, throttling, reset, polling)
- Tests para SyncDashboard (startPhase2, cancelSync, polling)
- Mocks actualizados para compatibilidad con versiones antiguas de Jasmine
- Mock de Date.now() para controlar tiempo en tests de throttling
- SpecRunner.html actualizado con nuevos specs

Cubre: múltiples inicializaciones, throttling, cancelación, polling"
```

## Commit 5: Documentación análisis y mejoras adicionales
**Tipo:** `docs` / `chore`
**Descripción:** Documentación de análisis y mejoras adicionales

```bash
git add docs/ANALISIS_*.md includes/CacheManager.php includes/Sync/ImageProcessor.php includes/Sync/ImageSyncManager.php assets/js/dashboard/components/ConsoleManager.js composer.json phpstan.neon uninstall.php
git commit -m "docs: documentación análisis Fase 2 y mejoras adicionales

- 15 documentos de análisis (rendimiento, errores, polling, etc.)
- Mejoras en CacheManager
- Mejoras en ImageProcessor e ImageSyncManager
- Ajustes en ConsoleManager, composer.json, phpstan.neon, uninstall.php"
```

---

## Alternativa: Commits más granulares

Si prefieres commits más específicos, puedes dividir así:

1. **perf(fase2): optimización consultas SQL MapProduct**
2. **perf(fase2): optimización logging y fallback hash**
3. **perf(fase2): optimización limpieza caché y delays**
4. **fix(fase2): corrección error isDebugEnabled**
5. **fix(fase2): manejo excepciones en mapeo productos**
6. **feat(fase2): throttling logs advertencia**
7. **feat(fase2): reset mejorado con limpieza polling**
8. **feat(fase2): cancelación mejorada**
9. **test(fase2): tests Jasmine Phase2Manager**
10. **test(fase2): tests Jasmine SyncDashboard**
11. **docs: documentación análisis Fase 2**

---

## Verificación antes de commit

```bash
# Ver cambios por archivo
git diff --stat

# Ver cambios específicos
git diff includes/Helpers/MapProduct.php | head -50

# Verificar que no hay archivos temporales
git status
```

